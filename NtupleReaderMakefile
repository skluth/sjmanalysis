
CXX      = g++
RC       = rootcint
OPT      = -g
CXXFLAGS = -Wall -fPIC $(OPT)

FASTJETCONFIG = $(HOME)/qcd/fastjet/fastjet-3.0.6/install/bin/fastjet-config
FASTJETINC = $(shell $(FASTJETCONFIG) --cxxflags )
FASTJETLIBS = $(shell $(FASTJETCONFIG) --libs --plugins )

ROOTINC = $(shell root-config --noauxcflags --cflags )
ROOTLIBS = $(shell root-config --libs )

CPPFLAGS = $(ROOTINC) $(FASTJETINC)

SRCS = NtupleReader.cc TFastJet.cc JetrateDataStructure.cc Observable.cc Analysis.cc ObsFastJetR.cc ObsFastJetEmin.cc DifferentialDataStructure.cc ObsDifferential.cc ObsFastJetDiff.cc ObsJetrate.cc ObsThrust.cc Unfolder.cc OutputWriter.cc ObservableFactory.cc
DICT = NtupleReaderDict.cc
DICTLIB = libNtupleReaderDict.so
LIB= libNtupleReader.so

all: $(DICTLIB)

AnalysisDict.cc: Analysis.hh AnalysisLinkDef.h
	$(RC) -f $@ -c $^

libAnalysisDict.so: AnalysisDict.o Analysis.o
	$(CXX) -shared -Wl,--no-as-needed $(ROOTLIBS) -o $@ $^

$(DICT): $(SRCS:.cc=.hh) $(DICT:Dict.cc=LinkDef.h)
	$(RC) -f $@ -c $^

$(DICTLIB): $(DICT:.cc=.o) $(SRCS:.cc=.o)
	$(CXX) -shared -Wl,--no-as-needed $(ROOTLIBS) $(FASTJETLIBS) -o $@ $^

$(LIB): $(SRCS:.cc=.o)
	$(CXX) -shared -Wl,--no-as-needed $(ROOTLIBS) $(FASTJETLIBS) -o $@ $^


clean:
	rm -f $(DICTLIB) $(DICT:.cc=.*) $(SRCS:.cc=.o) $(LIB)

INTERMEDIATE: $(DICTS)

