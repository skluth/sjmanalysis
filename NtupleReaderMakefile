
# Makefile for sjmanalysis package

CXX      = g++
RC       = rootcint
OPT      = -g
CXXFLAGS = -Wall -fPIC $(OPT)

FASTJETCONFIG = $(HOME)/qcd/fastjet/fastjet-3.0.6/install/bin/fastjet-config
FASTJETINC = $(shell $(FASTJETCONFIG) --cxxflags )
FASTJETLIBS = $(shell $(FASTJETCONFIG) --libs --plugins )

ROOTINC = $(shell root-config --noauxcflags --cflags )
ROOTLIBS = $(shell root-config --libs )

CPPFLAGS = $(ROOTINC) $(FASTJETINC)

SRCS = NtupleReader.cc TFastJet.cc Analysis.cc \
JetrateDataStructure.cc DifferentialDataStructure.cc MatrixDataStructure.cc \
Observable.cc ObsDifferential.cc ObsJetrate.cc \
ObsFastJetR.cc ObsFastJetEmin.cc ObsFastJetYcut.cc \
ObsFastJetDiff.cc ObsDurhamYmerge23.cc ObsJadeYmerge23.cc \
ObsThrust.cc ObsMr.cc ObservableFactory.cc \
FilledObservable.cc \
Unfolder.cc OutputWriter.cc 

DICT = NtupleReaderDict.cc
DICTLIB = libNtupleReaderDict.so
LIB= libNtupleReader.so
DEPS = $(SRCS:.cc=.d)

all: $(DICTLIB)

$(DEPS): %.d: %.cc
	$(CXX) $(CPPFLAGS) -MM $< -MF $@
-include $(DEPS)

AnalysisDict.cc: Analysis.hh AnalysisLinkDef.h
	$(RC) -f $@ -c $^

libAnalysisDict.so: AnalysisDict.o Analysis.o
	$(CXX) -shared -Wl,--no-as-needed $(ROOTLIBS) -o $@ $^

$(DICT): $(SRCS:.cc=.hh) $(DICT:Dict.cc=LinkDef.h)
	$(RC) -f $@ -c $^

$(DICTLIB): $(DICT:.cc=.o) $(SRCS:.cc=.o)
	$(CXX) -shared -Wl,--no-as-needed $(ROOTLIBS) $(FASTJETLIBS) -o $@ $^

$(LIB): $(SRCS:.cc=.o)
	$(CXX) -shared -Wl,--no-as-needed $(ROOTLIBS) $(FASTJETLIBS) -o $@ $^

clean:
	rm -f $(DICTLIB) $(DICT:.cc=.*) $(SRCS:.cc=.o) $(LIB) $(DEPS) AnalysisDict.*

INTERMEDIATE: $(DICTS) AnalysisDict.*
